<div class="sci-fi-dashboard" data-controller="chat">
  <div class="sci-fi-sidebar pl-3" data-chat-target="sidebar">
    <div class="text-center mb-4">
      <h4 class="neon-text">Hi <%= @current_user.username %></h4>
    </div>

    <%= turbo_stream_from "unreads_#{@current_user.id}" %>

    <div class="mb-4">
      <h5 class="section-title">Users</h5>
      <%= turbo_stream_from "users" %>
      <div id="users" class="scrollable">
        <%= render @users %>
      </div>
    </div>

    <div class="mb-4">
      <h5 class="section-title">Rooms</h5>
      <%= render partial: "layouts/new_room_form" %>
      <%= turbo_stream_from "rooms" %>
      <div id="rooms" class="scrollable">
        <%= render partial: "rooms/room", collection: @rooms, as: :room, locals: { user: @current_user } %>
      </div>
    </div>

    <div class="mt-auto text-center">
      <%= link_to 'Sign Out', signout_path, data: { turbo_method: :delete }, class: "btn btn-logout" %>
    </div>
  </div>

  <div class="sci-fi-main bg-dark text-light p-4" data-chat-target="panel">
    <turbo-frame id="chat_panel" target="_top">
      <% if @single_room %>
        <!-- HEADER -->
        <div class="chat-header text-center mb-3 d-flex align-items-center justify-content-between">
          <button class="btn-back d-md-none btn-back" data-action="click->chat#close">
            âœ–
          </button>

          <h4 class="neon-text flex-grow-1 text-center mb-0">
            ðŸ’¬ <%= @user&.username || @single_room.name %>
          </h4>

          <span class="d-md-none" style="width:32px;"></span>
        </div>

        <!-- CONTENEDOR DEL CHAT -->
        <turbo-frame
          class="chat-area d-flex flex-column"
          id="chat-container"
          data-controller="messages"
          data-messages-current-user-id-value="<%= @current_user.id %>"
        >
          <% if @single_room.is_private %>
            <%= turbo_stream_from [@single_room, @current_user] %>
          <% else %>
            <%= turbo_stream_from [@single_room, @current_user] %>
            <%= turbo_stream_from @single_room %>
          <% end %>

          <div id="messages" class="chat-messages flex-grow-1" data-messages-target="messages">
            <%= render @messages %>
          </div>

          <%= render partial: 'layouts/new_message_form' %>
        </turbo-frame>
      <% else %>
        <div class="welcome-message text-center">
          <h2 class="neon-text">âœ¨ Bienvenido a ChatLifeApp âœ¨</h2>
          <p class="text-muted">Selecciona un chat o crea un nuevo room para comenzar.</p>
        </div>
      <% end %>
    </turbo-frame>
  </div>
</div>
